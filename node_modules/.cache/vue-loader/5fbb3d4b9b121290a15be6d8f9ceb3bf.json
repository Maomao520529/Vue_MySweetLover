{"remainingRequest":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\src\\views\\backEnd\\Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\src\\views\\backEnd\\Coupons.vue","mtime":1580890501000},{"path":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Maomao File\\新增資料夾 (2)\\Vue_EC-master\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IENpcmNsZTQgfSBmcm9tICd2dWUtbG9hZGluZy1zcGlubmVyJwppbXBvcnQgUGFnaW5hdGlvbiBmcm9tICcuLi8uLi9jb21wb25lbnRzL1BhZ2luYXRpb24nCmltcG9ydCAkIGZyb20gJ2pxdWVyeScKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnY291cG9ucycsCiAgY29tcG9uZW50czogewogICAgUGFnaW5hdGlvbiwKICAgIENpcmNsZTQKICB9LAogIGRhdGEgKCkgewogICAgcmV0dXJuIHsKICAgICAgY291cG9uczogW10sCiAgICAgIHBhZ2luYXRpb246IHt9LAogICAgICB0ZW1wQ291cG9uOiB7CiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIGlzX2VuYWJsZWQ6IDAsCiAgICAgICAgcGVyY2VudDogMTAwLAogICAgICAgIGR1ZV9kYXRlOiAwLAogICAgICAgIGNvZGU6ICcnCiAgICAgIH0sCiAgICAgIGlzTmV3OiBmYWxzZSwKICAgICAgZHVlX2RhdGU6IG5ldyBEYXRlKCksCiAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgIHN0YXR1czogewogICAgICAgIGxvYWRpbmdJdGVtOiAnJwogICAgICB9CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgZHVlX2RhdGUgKCkgewogICAgICBjb25zdCB2bSA9IHRoaXMKICAgICAgLy8g5L2/55SoIG5ldyBEYXRlKHZtLmR1ZV9kYXRlKSAvIDEwMDAg5bCH5pel5pyf6L2J5o+b5oiQ5q+r56eSCiAgICAgIC8vIOS9v+eUqCBNYXRoLmZsb29yKCkg5bCH5q+r56eS5Zub5o2o5LqU5YWl5Y+W5pW05pW4CiAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IE1hdGguZmxvb3IobmV3IERhdGUodm0uZHVlX2RhdGUpIC8gMTAwMCkKICAgICAgdm0udGVtcENvdXBvbi5kdWVfZGF0ZSA9IHRpbWVzdGFtcAogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgZ2V0Q291cG9ucyAoKSB7CiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICBjb25zdCBhcGkgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0FQSVBBVEh9L2FwaS8ke3Byb2Nlc3MuZW52LlZVRV9BUFBfQ1VTVE9NUEFUSH0vYWRtaW4vY291cG9uc2AKICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZQogICAgICB2bS4kaHR0cC5nZXQoYXBpKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKQogICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlCiAgICAgICAgdm0uY291cG9ucyA9IHJlc3BvbnNlLmRhdGEuY291cG9ucwogICAgICB9KQogICAgfSwKICAgIG9wZW5Db3Vwb25Nb2RhbCAoaXNOZXcsIGl0ZW0pIHsKICAgICAgY29uc3Qgdm0gPSB0aGlzCiAgICAgIGlmIChpc05ldykgewogICAgICAgIHZtLmlzTmV3ID0gdHJ1ZQogICAgICAgIHZtLnRlbXBDb3Vwb24gPSB7fQogICAgICAgICQoJy5jb3Vwb25UaXRsZScpLnRleHQoJ+aWsOWinuWEquaDoOWIuCcpCiAgICAgICAgJCgnLmFkZENvdXBvbicpLnRleHQoJ+aWsOWinuWEquaDoOWIuCcpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm0uaXNOZXcgPSBmYWxzZQogICAgICAgIHZtLnRlbXBDb3Vwb24gPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtKQogICAgICAgICQoJy5jb3Vwb25UaXRsZScpLnRleHQoJ+e3qOi8r+WEquaDoOWIuCcpCiAgICAgICAgJCgnLmFkZENvdXBvbicpLnRleHQoJ+abtOaWsOWEquaDoOWIuCcpCiAgICAgIH0KICAgICAgJCgnI2NvdXBvbk1vZGFsJykubW9kYWwoJ3Nob3cnKQogICAgfSwKICAgIHVwZGF0ZUNvdXBvbiAoKSB7CiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICBsZXQgYXBpID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElQQVRIfS9hcGkvJHtwcm9jZXNzLmVudi5WVUVfQVBQX0NVU1RPTVBBVEh9L2FkbWluL2NvdXBvbmAKICAgICAgbGV0IGh0dHBNZXRob2QgPSAncG9zdCcKICAgICAgaWYgKCF2bS5pc05ldykgewogICAgICAgIGFwaSA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJUEFUSH0vYXBpLyR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRIfS9hZG1pbi9jb3Vwb24vJHt2bS50ZW1wQ291cG9uLmlkfWAKICAgICAgICBodHRwTWV0aG9kID0gJ3B1dCcKICAgICAgfQogICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlCiAgICAgIHZtLiRodHRwW2h0dHBNZXRob2RdKGFwaSwgeyBkYXRhOiB2bS50ZW1wQ291cG9uIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpCiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2UKICAgICAgICAkKCcjY291cG9uTW9kYWwnKS5tb2RhbCgnaGlkZScpCiAgICAgICAgdm0uZ2V0Q291cG9ucygpCiAgICAgIH0pCiAgICB9LAogICAgb3BlbkRlbE1vZGFsIChpdGVtKSB7CiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICB2bS50ZW1wQ291cG9uID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSkKICAgICAgJCgnLmRlbE1vZGFsVGl0bGUnKS50ZXh0KGDliKrpmaTlhKrmg6DliLjvvJoke3ZtLnRlbXBDb3Vwb24udGl0bGV9YCkKICAgICAgJCgnI2RlbENvdXBvbk1vZGFsJykubW9kYWwoJ3Nob3cnKQogICAgfSwKICAgIGRlbENvdXBvbiAoKSB7CiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICBjb25zdCBhcGkgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0FQSVBBVEh9L2FwaS8ke3Byb2Nlc3MuZW52LlZVRV9BUFBfQ1VTVE9NUEFUSH0vYWRtaW4vY291cG9uLyR7dm0udGVtcENvdXBvbi5pZH1gCiAgICAgIHZtLnN0YXR1cy5sb2FkaW5nSXRlbSA9IHZtLnRlbXBDb3Vwb24uaWQKICAgICAgdm0uJGh0dHAuZGVsZXRlKGFwaSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSkKICAgICAgICB2bS5zdGF0dXMubG9hZGluZ0l0ZW0gPSAnJwogICAgICAgICQoJyNkZWxDb3Vwb25Nb2RhbCcpLm1vZGFsKCdoaWRlJykKICAgICAgICB2bS5nZXRDb3Vwb25zKCkKICAgICAgfSkKICAgIH0KICB9LAogIGNyZWF0ZWQgKCkgewogICAgdGhpcy5nZXRDb3Vwb25zKCkKICB9Cn0K"},{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqKA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Coupons.vue","sourceRoot":"src/views/backEnd","sourcesContent":["<template>\n  <div class=\"products\">\n    <loading :active.sync=\"isLoading\">\n      <Circle4></Circle4>\n    </loading>\n\n    <div class=\"text-right mb-4\">\n      <button class=\"btn btn-outline-primary\" @click.prevent=\"openCouponModal(true)\">\n        <i class=\"fas fa-plus mr-2\"></i>新增優惠券\n      </button>\n    </div>\n    <table class=\"table table-hover\">\n      <thead>\n        <tr>\n          <th class=\"text-left\">名稱</th>\n          <th class=\"text-left\">優待碼</th>\n          <th class=\"text-center\">折扣百分比</th>\n          <th class=\"text-center\">到期日</th>\n          <th class=\"text-center\">是否啟用</th>\n          <th class=\"text-center\">編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"item in coupons\" :key=\"item.id\">\n          <td class=\"text-left\">{{ item.title }}</td>\n          <td class=\"text-left\">{{ item.code }}</td>\n          <td class=\"text-center\">{{ item.percent }}%</td>\n          <td class=\"text-center\">{{ item.due_date | date }}</td>\n          <td class=\"text-center\">\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else>未啟用</span>\n          </td>\n          <td class=\"text-center\">\n            <div class=\"btn-group\" role=\"group\">\n              <button\n                type=\"button\"\n                class=\"btn btn-outline-primary\"\n                @click.prevent=\"openCouponModal (false, item)\"\n              >編輯</button>\n              <button\n                type=\"button\"\n                class=\"btn btn-outline-danger\"\n                @click.prevent=\"openDelModal (item)\"\n              >刪除</button>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- Start Pagination -->\n    <div class=\"d-flex justify-content-center\" v-if=\"pagination.length\">\n      <Pagination :pages=\"pagination\" @emitPages=\"getCoupons\"></Pagination>\n    </div>\n    <!-- End Pagination -->\n\n    <!-- Start CouponModal -->\n    <div\n      class=\"modal fade\"\n      id=\"couponModal\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\"\n    >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 class=\"modal-title couponTitle\" id=\"exampleModalLabel\">Modal title</h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"form-group\">\n              <label for=\"title\">標題</label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"title\"\n                v-model=\"tempCoupon.title\"\n                placeholder=\"請輸入標題\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"coupon_code\">優惠碼</label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"coupon_code\"\n                v-model=\"tempCoupon.code\"\n                placeholder=\"請輸入優惠碼\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"due_date\">到期日</label>\n              <input type=\"date\" class=\"form-control\" id=\"due_date\" v-model=\"due_date\" />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"price\">折扣百分比</label>\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"price\"\n                v-model=\"tempCoupon.percent\"\n                placeholder=\"請輸入折扣百分比\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <div class=\"form-check\">\n                <input\n                  class=\"form-check-input\"\n                  type=\"checkbox\"\n                  :true-value=\"1\"\n                  :false-value=\"0\"\n                  v-model=\"tempCoupon.is_enabled\"\n                  id=\"is_enabled\"\n                />\n                <label class=\"form-check-label\" for=\"is_enabled\">是否啟用</label>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n            <button type=\"button\" class=\"btn btn-primary addCoupon\" @click=\"updateCoupon\">更新優惠券</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- End ProductModal -->\n\n    <!-- Start DelModal -->\n    <div\n      class=\"modal fade\"\n      id=\"delCouponModal\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\"\n    >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-danger text-white\">\n            <h5 class=\"modal-title delModalTitle\" id=\"exampleModalLabel\">\n              <span>刪除產品</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            是否刪除\n            <strong class=\"text-danger\">{{ tempCoupon.title }}</strong> 商品(刪除後將無法恢復)。\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-outline-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-danger\" @click.prevent=\"delCoupon\"><i class=\"fas fa-spinner fa-spin mr-2\" v-if=\"status.loadingItem === tempCoupon.id\"></i>確認刪除</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- End DelModal -->\n  </div>\n</template>\n<script>\nimport { Circle4 } from 'vue-loading-spinner'\nimport Pagination from '../../components/Pagination'\nimport $ from 'jquery'\n\nexport default {\n  name: 'coupons',\n  components: {\n    Pagination,\n    Circle4\n  },\n  data () {\n    return {\n      coupons: [],\n      pagination: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        due_date: 0,\n        code: ''\n      },\n      isNew: false,\n      due_date: new Date(),\n      isLoading: false,\n      status: {\n        loadingItem: ''\n      }\n    }\n  },\n  watch: {\n    due_date () {\n      const vm = this\n      // 使用 new Date(vm.due_date) / 1000 將日期轉換成毫秒\n      // 使用 Math.floor() 將毫秒四捨五入取整數\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000)\n      vm.tempCoupon.due_date = timestamp\n    }\n  },\n  methods: {\n    getCoupons () {\n      const vm = this\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons`\n      vm.isLoading = true\n      vm.$http.get(api).then(response => {\n        console.log(response.data)\n        vm.isLoading = false\n        vm.coupons = response.data.coupons\n      })\n    },\n    openCouponModal (isNew, item) {\n      const vm = this\n      if (isNew) {\n        vm.isNew = true\n        vm.tempCoupon = {}\n        $('.couponTitle').text('新增優惠券')\n        $('.addCoupon').text('新增優惠券')\n      } else {\n        vm.isNew = false\n        vm.tempCoupon = Object.assign({}, item)\n        $('.couponTitle').text('編輯優惠券')\n        $('.addCoupon').text('更新優惠券')\n      }\n      $('#couponModal').modal('show')\n    },\n    updateCoupon () {\n      const vm = this\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`\n      let httpMethod = 'post'\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`\n        httpMethod = 'put'\n      }\n      vm.isLoading = true\n      vm.$http[httpMethod](api, { data: vm.tempCoupon }).then(response => {\n        console.log(response.data)\n        vm.isLoading = false\n        $('#couponModal').modal('hide')\n        vm.getCoupons()\n      })\n    },\n    openDelModal (item) {\n      const vm = this\n      vm.tempCoupon = Object.assign({}, item)\n      $('.delModalTitle').text(`刪除優惠券：${vm.tempCoupon.title}`)\n      $('#delCouponModal').modal('show')\n    },\n    delCoupon () {\n      const vm = this\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`\n      vm.status.loadingItem = vm.tempCoupon.id\n      vm.$http.delete(api).then(response => {\n        console.log(response.data)\n        vm.status.loadingItem = ''\n        $('#delCouponModal').modal('hide')\n        vm.getCoupons()\n      })\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n</script>\n"]}]}