{"remainingRequest":"D:\\作品集\\Vue_MySweetLover\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\作品集\\Vue_MySweetLover\\src\\views\\backEnd\\Coupons.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\作品集\\Vue_MySweetLover\\src\\views\\backEnd\\Coupons.vue","mtime":1583938794557},{"path":"D:\\作品集\\Vue_MySweetLover\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\作品集\\Vue_MySweetLover\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\作品集\\Vue_MySweetLover\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\作品集\\Vue_MySweetLover\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBQYWdpbmF0aW9uIGZyb20gJy4uLy4uL2NvbXBvbmVudHMvUGFnaW5hdGlvbicKaW1wb3J0ICQgZnJvbSAnanF1ZXJ5JwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdjb3Vwb25zJywKICBjb21wb25lbnRzOiB7CiAgICBQYWdpbmF0aW9uCiAgfSwKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvdXBvbnM6IFtdLAogICAgICBwYWdpbmF0aW9uOiB7fSwKICAgICAgdGVtcENvdXBvbjogewogICAgICAgIHRpdGxlOiAnJywKICAgICAgICBpc19lbmFibGVkOiAwLAogICAgICAgIHBlcmNlbnQ6IDEwMCwKICAgICAgICBkdWVfZGF0ZTogMCwKICAgICAgICBjb2RlOiAnJwogICAgICB9LAogICAgICBpc05ldzogZmFsc2UsCiAgICAgIGR1ZV9kYXRlOiBuZXcgRGF0ZSgpLAogICAgICBpc0xvYWRpbmc6IGZhbHNlLAogICAgICBzdGF0dXM6IHsKICAgICAgICBsb2FkaW5nSXRlbTogJycKICAgICAgfQogICAgfQogIH0sCiAgd2F0Y2g6IHsKICAgIGR1ZV9kYXRlICgpIHsKICAgICAgY29uc3Qgdm0gPSB0aGlzCiAgICAgIC8vIOS9v+eUqCBuZXcgRGF0ZSh2bS5kdWVfZGF0ZSkgLyAxMDAwIOWwh+aXpeacn+i9ieaPm+aIkOavq+enkgogICAgICAvLyDkvb/nlKggTWF0aC5mbG9vcigpIOWwh+avq+enkuWbm+aNqOS6lOWFpeWPluaVtOaVuAogICAgICBjb25zdCB0aW1lc3RhbXAgPSBNYXRoLmZsb29yKG5ldyBEYXRlKHZtLmR1ZV9kYXRlKSAvIDEwMDApCiAgICAgIHZtLnRlbXBDb3Vwb24uZHVlX2RhdGUgPSB0aW1lc3RhbXAKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldENvdXBvbnMgKCkgewogICAgICBjb25zdCB2bSA9IHRoaXMKICAgICAgY29uc3QgYXBpID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElQQVRIfS9hcGkvJHtwcm9jZXNzLmVudi5WVUVfQVBQX0NVU1RPTVBBVEh9L2FkbWluL2NvdXBvbnNgCiAgICAgIHZtLmlzTG9hZGluZyA9IHRydWUKICAgICAgdm0uJGh0dHAuZ2V0KGFwaSkudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSkKICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZQogICAgICAgIHZtLmNvdXBvbnMgPSByZXNwb25zZS5kYXRhLmNvdXBvbnMKICAgICAgfSkKICAgIH0sCiAgICBvcGVuQ291cG9uTW9kYWwgKGlzTmV3LCBpdGVtKSB7CiAgICAgIGNvbnN0IHZtID0gdGhpcwogICAgICBpZiAoaXNOZXcpIHsKICAgICAgICB2bS5pc05ldyA9IHRydWUKICAgICAgICB2bS50ZW1wQ291cG9uID0ge30KICAgICAgICAkKCcuY291cG9uVGl0bGUnKS50ZXh0KCfmlrDlop7lhKrmg6DliLgnKQogICAgICAgICQoJy5hZGRDb3Vwb24nKS50ZXh0KCfnorroqo3mlrDlop7lhKrmg6DliLgnKQogICAgICB9IGVsc2UgewogICAgICAgIHZtLmlzTmV3ID0gZmFsc2UKICAgICAgICB2bS50ZW1wQ291cG9uID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSkKICAgICAgICAkKCcuY291cG9uVGl0bGUnKS50ZXh0KCfnt6jovK/lhKrmg6DliLgnKQogICAgICAgICQoJy5hZGRDb3Vwb24nKS50ZXh0KCfmm7TmlrDlhKrmg6DliLgnKQogICAgICB9CiAgICAgICQoJyNjb3Vwb25Nb2RhbCcpLm1vZGFsKCdzaG93JykKICAgIH0sCiAgICB1cGRhdGVDb3Vwb24gKCkgewogICAgICBjb25zdCB2bSA9IHRoaXMKICAgICAgbGV0IGFwaSA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQVBJUEFUSH0vYXBpLyR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9DVVNUT01QQVRIfS9hZG1pbi9jb3Vwb25gCiAgICAgIGxldCBodHRwTWV0aG9kID0gJ3Bvc3QnCiAgICAgIGlmICghdm0uaXNOZXcpIHsKICAgICAgICBhcGkgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0FQSVBBVEh9L2FwaS8ke3Byb2Nlc3MuZW52LlZVRV9BUFBfQ1VTVE9NUEFUSH0vYWRtaW4vY291cG9uLyR7dm0udGVtcENvdXBvbi5pZH1gCiAgICAgICAgaHR0cE1ldGhvZCA9ICdwdXQnCiAgICAgIH0KICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZQogICAgICB2bS4kaHR0cFtodHRwTWV0aG9kXShhcGksIHsgZGF0YTogdm0udGVtcENvdXBvbiB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKQogICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlCiAgICAgICAgJCgnI2NvdXBvbk1vZGFsJykubW9kYWwoJ2hpZGUnKQogICAgICAgIHZtLmdldENvdXBvbnMoKQogICAgICB9KQogICAgfSwKICAgIG9wZW5EZWxNb2RhbCAoaXRlbSkgewogICAgICBjb25zdCB2bSA9IHRoaXMKICAgICAgdm0udGVtcENvdXBvbiA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW0pCiAgICAgICQoJy5kZWxNb2RhbFRpdGxlJykudGV4dChg5Yiq6Zmk5YSq5oOg5Yi477yaJHt2bS50ZW1wQ291cG9uLnRpdGxlfWApCiAgICAgICQoJyNkZWxDb3Vwb25Nb2RhbCcpLm1vZGFsKCdzaG93JykKICAgIH0sCiAgICBkZWxDb3Vwb24gKCkgewogICAgICBjb25zdCB2bSA9IHRoaXMKICAgICAgY29uc3QgYXBpID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9BUElQQVRIfS9hcGkvJHtwcm9jZXNzLmVudi5WVUVfQVBQX0NVU1RPTVBBVEh9L2FkbWluL2NvdXBvbi8ke3ZtLnRlbXBDb3Vwb24uaWR9YAogICAgICB2bS5zdGF0dXMubG9hZGluZ0l0ZW0gPSB2bS50ZW1wQ291cG9uLmlkCiAgICAgIHZtLiRodHRwLmRlbGV0ZShhcGkpLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpCiAgICAgICAgdm0uc3RhdHVzLmxvYWRpbmdJdGVtID0gJycKICAgICAgICAkKCcjZGVsQ291cG9uTW9kYWwnKS5tb2RhbCgnaGlkZScpCiAgICAgICAgdm0uZ2V0Q291cG9ucygpCiAgICAgIH0pCiAgICB9CiAgfSwKICBjcmVhdGVkICgpIHsKICAgIHRoaXMuZ2V0Q291cG9ucygpCiAgfQp9Cg=="},{"version":3,"sources":["Coupons.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyKA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Coupons.vue","sourceRoot":"src/views/backEnd","sourcesContent":["<template>\n  <div class=\"products\">\n    <loading :active.sync=\"isLoading\">\n      <img src=\"../../assets/images/load.gif\" alt=\"loading\">\n    </loading>\n\n    <div class=\"text-right mb-4\">\n      <button class=\"btn btn-outline-primary\" @click.prevent=\"openCouponModal(true)\">\n        <i class=\"fas fa-plus mr-2\"></i>新增優惠券\n      </button>\n    </div>\n    <table class=\"table table-hover\">\n      <thead>\n        <tr>\n          <th class=\"text-left\">名稱</th>\n          <th class=\"text-left\">優待碼</th>\n          <th class=\"text-center\">折扣百分比</th>\n          <th class=\"text-center\">到期日</th>\n          <th class=\"text-center\">是否啟用</th>\n          <th class=\"text-center\">編輯</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"item in coupons\" :key=\"item.id\">\n          <td class=\"text-left\">{{ item.title }}</td>\n          <td class=\"text-left\">{{ item.code }}</td>\n          <td class=\"text-center\">{{ item.percent }}%</td>\n          <td class=\"text-center\">{{ item.due_date | date }}</td>\n          <td class=\"text-center\">\n            <span v-if=\"item.is_enabled\" class=\"text-success\">啟用</span>\n            <span v-else>未啟用</span>\n          </td>\n          <td class=\"text-center\">\n            <div class=\"btn-group\" role=\"group\">\n              <button\n                type=\"button\"\n                class=\"btn btn-outline-primary\"\n                @click.prevent=\"openCouponModal (false, item)\"\n              >\n              <i class=\"fas fa-pencil-alt\"></i>\n              </button>\n              <button\n                type=\"button\"\n                class=\"btn btn-outline-orange\"\n                @click.prevent=\"openDelModal (item)\"\n              >\n              <i class=\"fas fa-trash-alt\"></i>\n              </button>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n\n    <!-- Start Pagination -->\n    <div class=\"d-flex justify-content-center\" v-if=\"pagination.length\">\n      <Pagination :pages=\"pagination\" @emitPages=\"getCoupons\"></Pagination>\n    </div>\n    <!-- End Pagination -->\n\n    <!-- Start CouponModal -->\n    <div\n      class=\"modal fade\"\n      id=\"couponModal\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\"\n    >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header bg-primary text-white\">\n            <h5 class=\"modal-title couponTitle\" id=\"exampleModalLabel\"><span>編輯優惠券</span></h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            <div class=\"form-group\">\n              <label for=\"title\">標題</label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"title\"\n                v-model=\"tempCoupon.title\"\n                placeholder=\"請輸入標題\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"coupon_code\">優惠碼</label>\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"coupon_code\"\n                v-model=\"tempCoupon.code\"\n                placeholder=\"請輸入優惠碼\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"due_date\">到期日</label>\n              <input type=\"date\" class=\"form-control\" id=\"due_date\" v-model=\"due_date\" />\n            </div>\n            <div class=\"form-group\">\n              <label for=\"price\">折扣百分比</label>\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"price\"\n                v-model=\"tempCoupon.percent\"\n                placeholder=\"請輸入折扣百分比\"\n              />\n            </div>\n            <div class=\"form-group\">\n              <div class=\"form-check\">\n                <input\n                  class=\"form-check-input\"\n                  type=\"checkbox\"\n                  :true-value=\"1\"\n                  :false-value=\"0\"\n                  v-model=\"tempCoupon.is_enabled\"\n                  id=\"is_enabled\"\n                />\n                <label class=\"form-check-label\" for=\"is_enabled\">是否啟用</label>\n              </div>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n            <button type=\"button\" class=\"btn btn-primary addCoupon\" @click=\"updateCoupon\">更新優惠券</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- End ProductModal -->\n\n    <!-- Start DelModal -->\n    <div\n      class=\"modal fade\"\n      id=\"delCouponModal\"\n      tabindex=\"-1\"\n      role=\"dialog\"\n      aria-labelledby=\"exampleModalLabel\"\n      aria-hidden=\"true\"\n    >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content border-0\">\n          <div class=\"modal-header bg-orange text-white\">\n            <h5 class=\"modal-title delModalTitle\" id=\"exampleModalLabel\">\n              <span>刪除產品</span>\n            </h5>\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n              <span aria-hidden=\"true\">&times;</span>\n            </button>\n          </div>\n          <div class=\"modal-body\">\n            是否刪除\n            <strong class=\"text-orange\">{{ tempCoupon.title }}</strong> 商品(刪除後將無法恢復)。\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">取消</button>\n            <button type=\"button\" class=\"btn btn-orange\" @click.prevent=\"delCoupon\"><i class=\"fas fa-spinner fa-spin mr-2\" v-if=\"status.loadingItem === tempCoupon.id\"></i>確認刪除</button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- End DelModal -->\n  </div>\n</template>\n<script>\nimport Pagination from '../../components/Pagination'\nimport $ from 'jquery'\n\nexport default {\n  name: 'coupons',\n  components: {\n    Pagination\n  },\n  data () {\n    return {\n      coupons: [],\n      pagination: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        due_date: 0,\n        code: ''\n      },\n      isNew: false,\n      due_date: new Date(),\n      isLoading: false,\n      status: {\n        loadingItem: ''\n      }\n    }\n  },\n  watch: {\n    due_date () {\n      const vm = this\n      // 使用 new Date(vm.due_date) / 1000 將日期轉換成毫秒\n      // 使用 Math.floor() 將毫秒四捨五入取整數\n      const timestamp = Math.floor(new Date(vm.due_date) / 1000)\n      vm.tempCoupon.due_date = timestamp\n    }\n  },\n  methods: {\n    getCoupons () {\n      const vm = this\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupons`\n      vm.isLoading = true\n      vm.$http.get(api).then(response => {\n        console.log(response.data)\n        vm.isLoading = false\n        vm.coupons = response.data.coupons\n      })\n    },\n    openCouponModal (isNew, item) {\n      const vm = this\n      if (isNew) {\n        vm.isNew = true\n        vm.tempCoupon = {}\n        $('.couponTitle').text('新增優惠券')\n        $('.addCoupon').text('確認新增優惠券')\n      } else {\n        vm.isNew = false\n        vm.tempCoupon = Object.assign({}, item)\n        $('.couponTitle').text('編輯優惠券')\n        $('.addCoupon').text('更新優惠券')\n      }\n      $('#couponModal').modal('show')\n    },\n    updateCoupon () {\n      const vm = this\n      let api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon`\n      let httpMethod = 'post'\n      if (!vm.isNew) {\n        api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`\n        httpMethod = 'put'\n      }\n      vm.isLoading = true\n      vm.$http[httpMethod](api, { data: vm.tempCoupon }).then(response => {\n        console.log(response.data)\n        vm.isLoading = false\n        $('#couponModal').modal('hide')\n        vm.getCoupons()\n      })\n    },\n    openDelModal (item) {\n      const vm = this\n      vm.tempCoupon = Object.assign({}, item)\n      $('.delModalTitle').text(`刪除優惠券：${vm.tempCoupon.title}`)\n      $('#delCouponModal').modal('show')\n    },\n    delCoupon () {\n      const vm = this\n      const api = `${process.env.VUE_APP_APIPATH}/api/${process.env.VUE_APP_CUSTOMPATH}/admin/coupon/${vm.tempCoupon.id}`\n      vm.status.loadingItem = vm.tempCoupon.id\n      vm.$http.delete(api).then(response => {\n        console.log(response.data)\n        vm.status.loadingItem = ''\n        $('#delCouponModal').modal('hide')\n        vm.getCoupons()\n      })\n    }\n  },\n  created () {\n    this.getCoupons()\n  }\n}\n</script>\n"]}]}